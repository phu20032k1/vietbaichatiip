<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - ChatIIP CMS</title>

    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        margin: 0;
        background: #f3f4f6;
        color: #111827;
      }

      /* LOGIN */
      .login-box {
        max-width: 420px;
        margin: 60px auto;
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      }
      .login-box h2 {
        margin: 0 0 12px;
      }
      .field {
        margin-bottom: 10px;
        display: flex;
        flex-direction: column;
        gap: 4px;
        font-size: 14px;
      }
      .field label {
        font-weight: 600;
      }
      input,
      textarea,
      select {
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        padding: 8px 10px;
        font-size: 14px;
        font-family: inherit;
        outline: none;
      }
      input:focus,
      textarea:focus,
      select:focus {
        border-color: #94a3b8;
        box-shadow: 0 0 0 3px rgba(148, 163, 184, 0.25);
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 8px 16px;
        cursor: pointer;
        font-size: 14px;
        font-family: inherit;
      }
      .btn-primary {
        background: #111827;
        color: #fff;
      }
      .btn-secondary {
        background: #e5e7eb;
        color: #111827;
      }
      .btn-danger {
        background: #dc2626;
        color: #fff;
      }
      .btn-link {
        background: transparent;
        color: #2563eb;
        padding: 0;
        border-radius: 0;
      }

      .hidden {
        display: none;
      }

      /* CMS LAYOUT */
      #cmsView {
        max-width: 1280px;
        margin: 20px auto;
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        overflow: hidden;
      }
      .cms-header {
        padding: 16px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #e5e7eb;
      }
      .cms-header h1 {
        font-size: 20px;
        margin: 0;
      }

      .cms-tabs {
        padding: 10px 20px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .tab-btn {
        border: none;
        background: #e5e7eb;
        padding: 9px 14px;
        border-radius: 999px;
        cursor: pointer;
        font-size: 14px;
        color: #374151;
      }
      .tab-btn.active {
        background: #111827;
        color: #ffffff;
      }

      .cms-body {
        padding: 16px 18px 20px;
      }

      .grid-2 {
        display: grid;
        grid-template-columns: minmax(0, 2fr) minmax(0, 1.2fr);
        gap: 16px;
      }

      .grid-2-wide {
        display: grid;
        grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.3fr);
        gap: 16px;
      }

      @media (max-width: 980px) {
        .grid-2,
        .grid-2-wide {
          grid-template-columns: 1fr;
        }
      }

      /* BOX */
      .box {
        background: #ffffff;
        border-radius: 10px;
        border: 1px solid #e5e7eb;
        overflow: hidden;
      }
      .box + .box {
        margin-top: 12px;
      }
      .box-header {
        padding: 10px 12px;
        background: linear-gradient(90deg, #00a38c, #0090c7);
        color: #ffffff;
        font-weight: 700;
        font-size: 14px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
      }
      .box-body {
        padding: 12px;
      }

      .muted {
        color: #6b7280;
        font-size: 12px;
      }

      /* LIST */
      .list {
        max-height: 520px;
        overflow-y: auto;
        padding-right: 6px;
      }
      .list::-webkit-scrollbar {
        width: 8px;
      }
      .list::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 6px;
      }
      .list::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      .item {
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        padding: 10px 12px;
        margin-bottom: 10px;
        background: #f9fafb;
        position: relative;
      }
      .item-title {
        font-weight: 700;
        margin-bottom: 4px;
        line-height: 1.25;
      }
      .item-meta {
        font-size: 12px;
        color: #6b7280;
      }
      .tag {
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 999px;
        background: #e5e7eb;
        margin-left: 6px;
        display: inline-block;
        vertical-align: middle;
      }
      .tag.ok {
        background: rgba(22, 163, 74, 0.15);
        color: #166534;
      }
      .tag.warn {
        background: rgba(245, 158, 11, 0.15);
        color: #92400e;
      }
      .tag.bad {
        background: rgba(220, 38, 38, 0.15);
        color: #991b1b;
      }

      .actions {
        margin-top: 10px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      /* Tooltip preview on hover */
      .preview-tip {
        position: absolute;
        left: 12px;
        right: 12px;
        top: calc(100% + 6px);
        background: #111827;
        color: #fff;
        padding: 10px 12px;
        border-radius: 10px;
        font-size: 12px;
        line-height: 1.4;
        display: none;
        z-index: 20;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
        white-space: pre-wrap;
      }
      .item:hover .preview-tip {
        display: block;
      }

      /* Toolbar */
      .toolbar {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      .toolbar input,
      .toolbar select {
        min-width: 160px;
      }

      /* Modal */
      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        display: none;
        justify-content: center;
        align-items: center;
        padding: 20px;
        z-index: 999;
      }
      .modal {
        width: min(980px, 100%);
        max-height: 90vh;
        overflow: hidden;
        background: #fff;
        border-radius: 14px;
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.35);
        display: flex;
        flex-direction: column;
      }
      .modal-header {
        padding: 14px 16px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
      }
      .modal-title {
        font-weight: 800;
        margin: 0;
        font-size: 16px;
        line-height: 1.3;
      }
      .modal-body {
        padding: 12px 16px 16px;
        overflow: auto;
      }
      .doc-tabs {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin: 10px 0 12px;
      }
      .doc-tab {
        padding: 8px 12px;
        border-radius: 999px;
        background: #e5e7eb;
        font-size: 13px;
        cursor: pointer;
      }
      .doc-tab.active {
        background: #111827;
        color: #fff;
      }
      .doc-panel {
        display: none;
      }
      .doc-panel.active {
        display: block;
      }
      .tree ul {
        margin: 6px 0 6px 18px;
        padding: 0;
      }
      .tree li {
        margin: 4px 0;
      }

      #toast {
        position: fixed;
        right: 20px;
        bottom: 20px;
        background: #16a34a;
        color: white;
        padding: 12px 18px;
        border-radius: 10px;
        font-size: 14px;
        display: none;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        animation: fadeIn 0.25s ease;
        z-index: 1000;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>

  <body>
    <!-- LOGIN -->
    <div id="loginView" class="login-box">
      <h2>ƒêƒÉng nh·∫≠p Admin</h2>
      <div class="field">
        <label>T√†i kho·∫£n</label>
        <input type="text" id="loginEmail" placeholder="Nh·∫≠p email" />
      </div>
      <div class="field">
        <label>M·∫≠t kh·∫©u</label>
        <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </div>
      <button class="btn-primary" id="loginBtn">ƒêƒÉng nh·∫≠p</button>
      <p id="loginMessage" style="color: #dc2626; margin-top: 10px"></p>
      <p class="muted" style="margin-top: 10px">
        G·ª£i √Ω: N·∫øu b·∫°n ƒë√£ ƒëƒÉng nh·∫≠p, trang s·∫Ω t·ª± v√†o CMS.
      </p>
    </div>

    <!-- CMS MAIN -->
    <div id="cmsView" class="hidden">
      <div class="cms-header">
        <h1>ChatIIP CMS</h1>
        <div style="display: flex; gap: 10px; align-items: center">
          <span class="muted" id="sessionInfo"></span>
          <button class="btn-secondary" id="logoutBtn">ƒêƒÉng xu·∫•t</button>
        </div>
      </div>

      <!-- TAB BAR -->
      <div class="cms-tabs">
        <button class="tab-btn active" data-tab="news">üì∞ Tin t·ª©c</button>
        <button class="tab-btn" data-tab="docs">üìö VƒÉn b·∫£n ph√°p lu·∫≠t</button>
        <button class="tab-btn" data-tab="logs">üïí L·ªãch s·ª≠ chatbot</button>
      </div>

      <div class="cms-body">
        <!-- =============== TAB: NEWS =============== -->
        <div id="tab-news" class="tab-content" style="display: block">
          <div class="grid-2">
            <!-- LEFT: FORM -->
            <div>
              <div class="box">
                <div class="box-header">So·∫°n tin t·ª©c</div>
                <div class="box-body">
                  <input type="hidden" id="editingNewsId" value="" />

                  <div class="field">
                    <label>Ti√™u ƒë·ªÅ</label>
                    <input type="text" id="newsTitle" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ" />
                  </div>

                  <div class="field">
                    <label>Slug (URL)</label>
                    <input type="text" id="newsSlug" placeholder="vd: cong-dung-mat-ong" />
                    <div class="muted">N·∫øu ƒë·ªÉ tr·ªëng, h·ªá th·ªëng s·∫Ω t·ª± t·∫°o t·ª´ ti√™u ƒë·ªÅ.</div>
                  </div>

                  <div class="field">
                    <label>M√¥ t·∫£ ng·∫Øn</label>
                    <textarea id="newsSubtitle" rows="2" placeholder="M√¥ t·∫£ ng·∫Øn ƒë·ªÉ hi·ªÉn th·ªã preview"></textarea>
                  </div>

                  <div class="field">
                    <label>·∫¢nh thumbnail (URL)</label>
                    <input type="text" id="newsImg" placeholder="https://..." />
                  </div>

                  <div class="field">
                    <label>Chuy√™n m·ª•c</label>
                    <input type="text" id="newsCategory" placeholder="vd: B·∫•t ƒë·ªông s·∫£n" />
                  </div>

                  <div class="field">
                    <label>Tr·∫°ng th√°i duy·ªát</label>
                    <select id="newsApproved">
                      <option value="true">ƒê√£ duy·ªát</option>
                      <option value="false">Ch∆∞a duy·ªát</option>
                    </select>
                  </div>

                  <div class="field">
                    <label>L√™n l·ªãch ƒëƒÉng</label>
                    <input type="datetime-local" id="newsScheduledAt" />
                    <div class="muted">ƒê·ªÉ tr·ªëng n·∫øu ƒëƒÉng ngay.</div>
                  </div>
                </div>
              </div>

              <div class="box">
                <div class="box-header">N·ªôi dung tin</div>
                <div class="box-body">
                  <textarea id="newsContent" rows="12" placeholder="N·ªôi dung (HTML)" ></textarea>
                </div>
              </div>

              <div class="box">
                <div class="box-header">SEO</div>
                <div class="box-body">
                  <div class="field">
                    <label>Meta title</label>
                    <input type="text" id="newsPageTitle" />
                  </div>
                  <div class="field">
                    <label>Meta description</label>
                    <textarea id="newsPageDescription" rows="2"></textarea>
                  </div>
                  <div class="field">
                    <label>Meta keywords</label>
                    <input type="text" id="newsPageKeywords" placeholder="t·ª´ kh√≥a 1, t·ª´ kh√≥a 2" />
                  </div>
                  <div class="field">
                    <label>OG image</label>
                    <input type="text" id="newsOgImage" placeholder="https://..." />
                  </div>
                  <div class="field">
                    <label>Canonical</label>
                    <input type="text" id="newsCanonical" placeholder="https://chatiip.com/article.html?..." />
                  </div>

                  <div style="display: flex; gap: 10px; flex-wrap: wrap">
                    <button class="btn-primary" id="newsSaveBtn">L∆∞u tin</button>
                    <button class="btn-secondary" id="newsResetBtn">Reset form</button>
                    <span class="muted" id="newsSaveMessage"></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- RIGHT: LIST -->
            <div>
              <div class="box">
                <div class="box-header">
                  <span>Danh s√°ch tin t·ª©c</span>
                  <button class="btn-secondary" id="newsReloadBtn">T·∫£i l·∫°i</button>
                </div>
                <div class="box-body">
                  <div class="toolbar" style="margin-bottom: 10px">
                    <input type="text" id="newsSearch" placeholder="T√¨m theo ti√™u ƒë·ªÅ/slug..." />
                  </div>
                  <div id="newsList" class="list"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- =============== TAB: DOCS =============== -->
        <div id="tab-docs" class="tab-content" style="display: none">
          <div class="grid-2-wide">
            <!-- LEFT: FORM -->
            <div>
              <div class="box">
                <div class="box-header">Upload / C·∫≠p nh·∫≠t vƒÉn b·∫£n</div>
                <div class="box-body">
                  <input type="hidden" id="editingDocId" value="" />

                  <div class="field">
                    <label>Ti√™u ƒë·ªÅ vƒÉn b·∫£n</label>
                    <input type="text" id="docTitle" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ" />
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px">
                    <div class="field">
                      <label>S·ªë hi·ªáu</label>
                      <input type="text" id="docSoHieu" placeholder="vd: 45/2025/Qƒê-TTg" />
                    </div>
                    <div class="field">
                      <label>Lo·∫°i vƒÉn b·∫£n</label>
                      <select id="docLoaiVanBan">
                        <option value="">-- Ch·ªçn --</option>
                        <option>Quy·∫øt ƒë·ªãnh</option>
                        <option>Ngh·ªã ƒë·ªãnh</option>
                        <option>Th√¥ng t∆∞</option>
                        <option>Ngh·ªã quy·∫øt</option>
                        <option>C√¥ng vƒÉn</option>
                        <option>Ch·ªâ th·ªã</option>
                        <option>Kh√°c</option>
                      </select>
                    </div>
                  </div>

                  <div class="field">
                    <label>C∆° quan ban h√†nh</label>
                    <input type="text" id="docCoQuan" placeholder="vd: Th·ªß t∆∞·ªõng Ch√≠nh ph·ªß / UBND TP..." />
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px">
                    <div class="field">
                      <label>M·ª•c l·ªõn (Lƒ©nh v·ª±c)</label>
                      <select id="docCategoryMajor"></select>
                      <div class="muted">D√πng ƒë·ªÉ ph√¢n lo·∫°i r√µ r√†ng nh∆∞ menu b√™n tr√°i.</div>
                    </div>
                    <div class="field">
                      <label>M·ª•c con</label>
                      <input type="text" id="docCategoryMinor" placeholder="vd: ƒê∆°n v·ªã h√†nh ch√≠nh, Thu·∫ø TNCN..." />
                      <div class="muted">C√≥ th·ªÉ ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng c·∫ßn.</div>
                    </div>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px">
                    <div class="field">
                      <label>Ng√†y ban h√†nh</label>
                      <input type="date" id="docNgayBanHanh" />
                    </div>
                    <div class="field">
                      <label>Ng√†y hi·ªáu l·ª±c</label>
                      <input type="date" id="docNgayHieuLuc" />
                    </div>
                    <div class="field">
                      <label>Ng√†y h·∫øt hi·ªáu l·ª±c</label>
                      <input type="date" id="docNgayHetHieuLuc" />
                    </div>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px">
                    <div class="field">
                      <label>T√¨nh tr·∫°ng</label>
                      <select id="docTinhTrang">
                        <option>Kh√¥ng x√°c ƒë·ªãnh</option>
                        <option>C√≤n hi·ªáu l·ª±c</option>
                        <option>H·∫øt hi·ªáu l·ª±c</option>
                      </select>
                    </div>
                    <div class="field">
                      <label>Tags (ph√¢n t√°ch b·∫±ng d·∫•u ph·∫©y)</label>
                      <input type="text" id="docTags" placeholder="vd: thu·∫ø, nh√† ·ªü c√¥ng v·ª•" />
                    </div>
                  </div>

                  <div class="field">
                    <label>Tr√≠ch y·∫øu / M√¥ t·∫£ ng·∫Øn</label>
                    <textarea id="docTrichYeu" rows="3" placeholder="D√πng ƒë·ªÉ preview khi di chu·ªôt v√†o" ></textarea>
                  </div>

                  <div class="field">
                    <label>File vƒÉn b·∫£n (PDF/DOCX)</label>
                    <input type="file" id="docFile" accept=".pdf,.docx,.txt" />
                    <div class="muted">
                      Upload hi·ªán ƒëang d√πng d·∫°ng <b>base64</b> (ƒë∆°n gi·∫£n, d·ªÖ ch·∫°y). PDF scan (·∫£nh) c√≥ th·ªÉ kh√¥ng tr√≠ch xu·∫•t ƒë∆∞·ª£c n·ªôi dung.
                    </div>
                  </div>

                  <div class="field">
                    <label>N·ªôi dung text (tu·ª≥ ch·ªçn)</label>
                    <textarea id="docTextContent" rows="8" placeholder="N·∫øu PDF scan kh√¥ng ƒë·ªçc ƒë∆∞·ª£c, b·∫°n c√≥ th·ªÉ d√°n n·ªôi dung text ·ªü ƒë√¢y ƒë·ªÉ hi·ªÉn th·ªã tab 'N·ªôi dung' v√† t·∫°o 'L∆∞·ª£c ƒë·ªì'."></textarea>
                  </div>

                  <div style="display: flex; gap: 10px; flex-wrap: wrap">
                    <button class="btn-primary" id="docSaveBtn">L∆∞u vƒÉn b·∫£n</button>
                    <button class="btn-secondary" id="docResetBtn">Reset form</button>
                    <button class="btn-secondary" id="docRegenerateOutlineBtn" title="T·∫°o l·∫°i l∆∞·ª£c ƒë·ªì t·ª´ textContent">T·∫°o l·∫°i l∆∞·ª£c ƒë·ªì</button>
                    <span class="muted" id="docSaveMessage"></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- RIGHT: LIST -->
            <div>
              <div class="box">
                <div class="box-header">
                  <span>Danh s√°ch vƒÉn b·∫£n</span>
                  <button class="btn-secondary" id="docsReloadBtn">T·∫£i l·∫°i</button>
                </div>
                <div class="box-body">
                  <div class="toolbar" style="margin-bottom: 10px">
                    <input type="text" id="docsSearch" placeholder="T√¨m theo ti√™u ƒë·ªÅ / s·ªë hi·ªáu" />
                    <select id="docsFilterCategory"></select>
                    <select id="docsFilterStatus">
                      <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                      <option>C√≤n hi·ªáu l·ª±c</option>
                      <option>H·∫øt hi·ªáu l·ª±c</option>
                      <option>Kh√¥ng x√°c ƒë·ªãnh</option>
                    </select>
                  </div>
                  <div class="muted" id="docsStats" style="margin-bottom: 10px"></div>
                  <div id="docsList" class="list"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- =============== TAB: LOGS =============== -->
        <div id="tab-logs" class="tab-content" style="display: none">
          <div class="box">
            <div class="box-header">
              <span>L·ªãch s·ª≠ ng∆∞·ªùi d√πng h·ªèi chatbot</span>
              <button class="btn-secondary" id="logsReloadBtn">T·∫£i l·∫°i</button>
            </div>
            <div class="box-body">
              <div class="toolbar" style="margin-bottom: 10px">
                <input type="text" id="logsSearch" placeholder="T√¨m c√¢u h·ªèi / c√¢u tr·∫£ l·ªùi..." />
                <select id="logsLimit">
                  <option value="30">30</option>
                  <option value="50" selected>50</option>
                  <option value="100">100</option>
                </select>
              </div>
              <div id="logsList" class="list"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: doc preview -->
    <div id="docModalBackdrop" class="modal-backdrop">
      <div class="modal">
        <div class="modal-header">
          <div>
            <h3 id="docModalTitle" class="modal-title">VƒÉn b·∫£n</h3>
            <div id="docModalMeta" class="item-meta"></div>
          </div>
          <button class="btn-secondary" id="docModalCloseBtn">ƒê√≥ng</button>
        </div>
        <div class="modal-body">
          <div class="doc-tabs">
            <div class="doc-tab active" data-doc-tab="summary">T√≥m t·∫Øt n·ªôi dung</div>
            <div class="doc-tab" data-doc-tab="content">N·ªôi dung</div>
            <div class="doc-tab" data-doc-tab="outline">L∆∞·ª£c ƒë·ªì</div>
            <div class="doc-tab" data-doc-tab="download">T·∫£i v·ªÅ</div>
          </div>

          <div id="docPanelSummary" class="doc-panel active"></div>
          <div id="docPanelContent" class="doc-panel"></div>
          <div id="docPanelOutline" class="doc-panel"></div>
          <div id="docPanelDownload" class="doc-panel"></div>
        </div>
      </div>
    </div>

    <div id="toast">OK</div>

    <!-- TinyMCE gi·ªëng Word (ch·ªâ d√πng cho tin t·ª©c) -->
    <script
      src="https://cdn.tiny.cloud/1/f6i907pnlns1vqkv5d2srlmk9pkudtb5nc5lebuy0wg77rku/tinymce/6/tinymce.min.js"
      referrerpolicy="origin"
    ></script>

    <script>
      tinymce.init({
        selector: "#newsContent",
        height: 520,
        plugins: `
          advlist anchor autolink autosave charmap code codesample directionality
          emoticons fullscreen help image importcss insertdatetime link lists media
          preview quickbars searchreplace table visualblocks visualchars wordcount
        `,
        toolbar: `
          undo redo | blocks fontfamily fontsize | bold italic underline strikethrough |
          forecolor backcolor | alignleft aligncenter alignright alignjustify |
          lineheight outdent indent | bullist numlist checklist |
          table tabledelete | image media link | searchreplace | fullscreen preview |
          emoticons charmap removeformat code
        `,
        menubar: "file edit view insert format tools table help",
        content_style: `
          body { font-family: Arial, sans-serif; padding: 12px; line-height: 1.65; }
          img { max-width: 100%; border-radius: 8px; }
        `
      });
    </script>

    <script src="./admin.js"></script>
  </body>
</html>
